<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minesweeper</title>
  <style>
    /* Minesweeper CSS */
    body {
      font-family: Arial, sans-serif;
      background-color: #f3f4f6;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 0;
    }

    header {
      margin-top: 20px;
      text-align: center;
    }

    header h1 {
      font-size: 2.5em;
      color: #333;
    }

    #info-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    #flag-count {
      font-size: 1.5em;
      margin-right: 20px;
      color: #333;
    }

    #timer {
      font-size: 1.5em;
      color: #333;
    }

    #best-time {
      font-size: 1.2em;
      color: #333;
      margin-left: 20px;
    }

    #game-container {
      margin: 20px 0;
      display: grid;
      gap: 1px;
      background-color: #333;
      padding: 5px;
    }

    .cell {
      width: 40px; /* Increased size */
      height: 40px; /* Increased size */
      background-color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.2em;
    }

    .cell.revealed {
      background-color: #9ca3af;
      cursor: default;
    }

    .cell.mine {
      background-color: red;
      color: white;
    }

    .cell.flag {
      background-color: #60a5fa;
      color: white;
    }

    #return-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      font-size: 1em;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }

    #return-btn:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <header>
    <h1>Minesweeper</h1>
  </header>
  <div id="info-container">
    <div id="flag-count">Flags Left: 20</div>
    <div id="timer">Time: 0</div>
    <div id="best-time">Best Time: --</div>
  </div>
  <button id="return-btn" onclick="returnToMenu()">Return to Menu</button> <!-- Return to Menu Button -->
  <div id="game-container"></div>
  <script>
    // Minesweeper JavaScript
    const rows = 10;
    const cols = 10;
    const mines = 20;
    const gameContainer = document.getElementById('game-container');
    const flagCountDisplay = document.getElementById('flag-count');
    const timerDisplay = document.getElementById('timer');
    const bestTimeDisplay = document.getElementById('best-time');

    let board = [];
    let revealedCells = 0;
    let flagsLeft = mines;
    let firstClick = true;
    let firstClickRow, firstClickCol;
    let timer;
    let startTime;
    let currentTime = 0;

    // Get the best time from localStorage if available
    let bestTime = localStorage.getItem('bestTime');
    if (bestTime) {
      bestTimeDisplay.textContent = `Best Time: ${bestTime}`;
    }

    function initGame() {
      gameContainer.innerHTML = '';
      board = Array.from({ length: rows }, () => Array(cols).fill(0));
      revealedCells = 0;
      flagsLeft = mines;
      firstClick = true;
      currentTime = 0;
      timerDisplay.textContent = `Time: 0`;
      flagCountDisplay.textContent = `Flags Left: ${flagsLeft}`;

      renderBoard();
    }

    function startTimer() {
      startTime = Date.now();
      timer = setInterval(() => {
        currentTime = Math.floor((Date.now() - startTime) / 1000);
        timerDisplay.textContent = `Time: ${currentTime}`;
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timer);
    }

    function placeMines(excludeRow, excludeCol) {
      let placed = 0;
      while (placed < mines) {
        const row = Math.floor(Math.random() * rows);
        const col = Math.floor(Math.random() * cols);

        // Skip placing mines on the first click cell or its adjacent cells
        if (board[row][col] === 0 &&
            !(row === excludeRow && col === excludeCol) &&
            !isAdjacent(row, col, excludeRow, excludeCol)) {
          board[row][col] = 'M';
          placed++;
        }
      }
    }

    function isAdjacent(row, col, excludeRow, excludeCol) {
      const directions = [
        [-1, -1], [-1, 0], [-1, 1],
        [0, -1],         [0, 1],
        [1, -1], [1, 0], [1, 1],
      ];
      for (const [dr, dc] of directions) {
        const nr = row + dr;
        const nc = col + dc;
        if (nr === excludeRow && nc === excludeCol) return true;
      }
      return false;
    }

    function calculateNumbers() {
      const directions = [
        [-1, -1], [-1, 0], [-1, 1],
        [0, -1],         [0, 1],
        [1, -1], [1, 0], [1, 1],
      ];

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          if (board[r][c] === 'M') continue;

          let count = 0;
          for (const [dr, dc] of directions) {
            const nr = r + dr;
            const nc = c + dc;
            if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && board[nr][nc] === 'M') {
              count++;
            }
          }
          board[r][c] = count;
        }
      }
    }

    function renderBoard() {
      gameContainer.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
      gameContainer.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.dataset.row = r;
          cell.dataset.col = c;
          cell.addEventListener('click', () => handleClick(r, c));
          cell.addEventListener('touchstart', (e) => handleTouchStart(e, r, c));
          cell.addEventListener('touchend', (e) => handleTouchEnd(e, r, c));
          gameContainer.appendChild(cell);
        }
      }
    }

    let touchStartTime = 0;
    let touchTimer = null;
    let activeCell = null;

    function handleTouchStart(e, row, col) {
      e.preventDefault(); // Prevent default behavior like zoom
      activeCell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
      touchStartTime = Date.now();
    }

    function handleTouchEnd(e, row, col) {
      const touchDuration = Date.now() - touchStartTime;

      if (touchDuration < 500) {
        // Short touch: reveal the cell
        handleClick(row, col);
      } else {
        // Long touch: place a flag
        toggleFlag(row, col);
      }
      activeCell = null;
    }

    function handleClick(row, col) {
      if (firstClick) {
        firstClickRow = row;
        firstClickCol = col;
        placeMines(firstClickRow, firstClickCol); // Avoid placing mines on first clicked cell and its neighbors
        calculateNumbers(); // Recalculate numbers after placing mines
        startTimer(); // Start timer on first click
        firstClick = false;
      }

      const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
      if (!cell || cell.classList.contains('revealed') || cell.classList.contains('flag')) return;

      cell.classList.add('revealed');
      revealedCells++;

      if (board[row][col] === 'M') {
        cell.classList.add('mine');
        gameOver(false);
      } else if (board[row][col] === 0) {
        revealAdjacentCells(row, col);
      } else {
        cell.textContent = board[row][col];
      }

      if (revealedCells === (rows * cols - mines)) {
        gameOver(true);
      }
    }

    function revealAdjacentCells(row, col) {
      const directions = [
        [-1, -1], [-1, 0], [-1, 1],
        [0, -1],         [0, 1],
        [1, -1], [1, 0], [1, 1],
      ];

      for (const [dr, dc] of directions) {
        const nr = row + dr;
        const nc = col + dc;
        if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
          const cell = document.querySelector(`.cell[data-row="${nr}"][data-col="${nc}"]`);
          if (!cell.classList.contains('revealed') && !cell.classList.contains('flag')) {
            handleClick(nr, nc);
          }
        }
      }
    }

    function toggleFlag(row, col) {
      const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
      if (cell.classList.contains('revealed')) return;

      cell.classList.toggle('flag');
      if (cell.classList.contains('flag')) {
        flagsLeft--;
      } else {
        flagsLeft++;
      }

      flagCountDisplay.textContent = `Flags Left: ${flagsLeft}`;
      cell.textContent = cell.classList.contains('flag') ? 'F' : '';
    }

    function gameOver(won) {
      stopTimer();
      if (won) {
        if (!bestTime || currentTime < bestTime) {
          bestTime = currentTime;
          localStorage.setItem('bestTime', bestTime);
        }
        bestTimeDisplay.textContent = `Best Time: ${bestTime}`;
      }
      alert(won ? 'You won!' : 'Game over!');
    }

    // Return to the menu (index page)
    function returnToMenu() {
      window.location.href = 'index.html'; // Make sure this points to your actual index page
    }

    initGame();
  </script>
</body>
</html>
